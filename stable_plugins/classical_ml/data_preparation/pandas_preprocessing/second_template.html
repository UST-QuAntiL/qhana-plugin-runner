{% extends "simple_template.html" %}

{% block head %}
    {{ super() }}
{% endblock head %}

{% block content %}
    <p id="pandas_str" hidden>{{pandas_html}}</p>
    <div id="pandas_html" style='height: 200px; overflow: auto; width: fit-content'></div>
    <div class="qhana-microfrontend">
        {% block help %}
        {% if help_text or example_values %}
        <details class="qhana-help">
            <summary>Help</summary>
            {% if help_text %}
            {% autoescape false %}
            {{help_text | markdown}}
            {% endautoescape %}
            {% else %}
            <br>
            {% endif %}
            {% if example_values %}
            <a href="{{example_values}}">Fill in example values.</a>
            {% endif %}
        </details>
        {% endif %}
        {% endblock help %}
        {% call forms.render_form(target="microfrontend") %}
        {{ forms.render_fields(schema, values=values, errors=errors) }}
        <div class="qhana-form-buttons">
            {{ forms.submit("validate", target="microfrontend")}}
            {{ forms.submit("add step", action=add_step)}}
            {{ forms.submit("done", action=process)}}
            {% if done %}
            {{ forms.submit("done", action=done)}}
            {% endif %}
            {% if not errors and valid %}
            <span class="qhana-input-description"> Validation successful!</span>
            <svg version="1.1" id="Layer_1"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="25" height="15" viewBox="0 0 122.881 89.842" enable-background="new 0 0 122.881 89.842"><g><path fill="rgb(0, 247, 0)" d="M1.232,55.541c-1.533-1.388-1.652-3.756-0.265-5.289c1.388-1.534,3.756-1.652,5.29-0.265l34.053,30.878l76.099-79.699 c1.429-1.501,3.804-1.561,5.305-0.132c1.502,1.428,1.561,3.803,0.133,5.305L43.223,88.683l-0.005-0.005 c-1.396,1.468-3.716,1.563-5.227,0.196L1.232,55.541L1.232,55.541z"/></g></svg>
            {% endif %}
        </div>
        {% endcall %}
    </div>
{% endblock content %}

{% block script %}
    <script>
        preprocessing_enum_value = document.getElementById("preprocessing_enum");
        pandas_str = document.getElementById("pandas_str");
        pandas_html = document.getElementById("pandas_html");

        axis_dis = document.getElementById("axis").parentNode.parentNode;
        threshold_dis = document.getElementById("threshold").parentNode.parentNode;
        subset_dis = document.getElementById("subset").parentNode.parentNode;
        fill_value_dis = document.getElementById("fill_value").parentNode.parentNode;
        keep_dis = document.getElementById("keep").parentNode.parentNode;
        ignore_index_dis = document.getElementById("ignore_index").parentNode.parentNode;
        by_dis = document.getElementById("by").parentNode.parentNode;
        ascending_dis = document.getElementById("ascending").parentNode.parentNode;
        position_dis = document.getElementById("position").parentNode.parentNode;
        characters_dis = document.getElementById("characters").parentNode.parentNode;
        column_dis = document.getElementById("column").parentNode.parentNode;
        new_columns_dis = document.getElementById("new_columns").parentNode.parentNode;
        remove_column_dis = document.getElementById("remove_column").parentNode.parentNode;
        substring_dis = document.getElementById("substring").parentNode.parentNode;
        new_str_dis = document.getElementById("new_str").parentNode.parentNode;
        case_dis = document.getElementById("case").parentNode.parentNode;


        function change_parameter(parameter, label, description) {
            for (var i = 0; i < parameter.childNodes.length; i++) {
                if (parameter.childNodes[i].className === "qhana-form-label" && label !== null) {
                    parameter.childNodes[i].innerText = label;
                }
                else if (parameter.childNodes[i].className === "qhana-input-description" && description !== null) {
                    parameter.childNodes[i].childNodes[1].innerText = description;
                }
            }
        }


        function preprocessing_enum_change() {
            axis_dis.style.display = "none";
            threshold_dis.style.display = "none";
            subset_dis.style.display = "none";
            fill_value_dis.style.display = "none";
            keep_dis.style.display = "none";
            ignore_index_dis.style.display = "none";
            by_dis.style.display = "none";
            ascending_dis.style.display = "none";
            position_dis.style.display = "none";
            characters_dis.style.display = "none";
            column_dis.style.display = "none";
            new_columns_dis.style.display = "none";
            remove_column_dis.style.display = "none";
            substring_dis.style.display = "none";
            new_str_dis.style.display = "none";
            case_dis.style.display = "none";

            if (preprocessing_enum_value.value === "drop_na") {
                axis_dis.style.display = "block";
                threshold_dis.style.display = "block";
                subset_dis.style.display = "block";
                change_parameter(subset_dis, null, "Labels along other axis to consider, e.g. if you are dropping rows these would be a list of columns to include.");
            }
            else if (preprocessing_enum_value.value === "fill_na") {
                fill_value_dis.style.display = "block";
            }
            else if (preprocessing_enum_value.value === "drop_duplicates") {
                subset_dis.style.display = "block";
                change_parameter(subset_dis, null, "Only consider certain columns for identifying duplicates, by default use all of the columns.");
                keep_dis.style.display = "block";
                ignore_index_dis.style.display = "block";
            }
            else if (preprocessing_enum_value.value === "sort_values") {
                by_dis.style.display = "block";
                change_parameter(by_dis, "Column", "Column to sort by.");
                ascending_dis.style.display = "block";
            }
            else if (preprocessing_enum_value.value === "strip_entries") {
                position_dis.style.display = "block";
                characters_dis.style.display = "block";
                subset_dis.style.display = "block";
                change_parameter(subset_dis, null, "Only strip entries in certain columns, by default use all of the columns.");
            }
            else if (preprocessing_enum_value.value === "split_column") {
                column_dis.style.display = "block";
                by_dis.style.display = "block";
                change_parameter(by_dis, "Split-String", "String that splits the column, e.g. the entry 'John, Doe' and the Split-String ', ' result in the two entries 'John' and 'Doe'.");
                new_columns_dis.style.display = "block";
                remove_column_dis.style.display = "block";
            }
            else if (preprocessing_enum_value.value === "replace") {
                substring_dis.style.display = "block";
                new_str_dis.style.display = "block";
                subset_dis.style.display = "block";
                change_parameter(subset_dis, null, "Only replace substrings of entries in certain columns, by default use all of the columns.");
            }
            else if (preprocessing_enum_value.value === "string_case") {
                case_dis.style.display = "block";
                subset_dis.style.display = "block";
                change_parameter(subset_dis, null, "Only change the case of entries in certain columns, by default use all of the columns.");
            }
        }


        pandas_html.innerHTML = pandas_str.innerText;
        preprocessing_enum_change();
        preprocessing_enum_value.addEventListener("change", preprocessing_enum_change);
    </script>
    {{ super() }}
{% endblock script %}

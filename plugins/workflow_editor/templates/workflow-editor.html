{% extends "simple_template.html" %}

{% block head %}
{{ super() }}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
<style>
    body {
        margin: 0px;
    }

    .content {
        width: 100vw;
        height: 100vh;
        display: relative;
        background-color: white;
        color: black;
    }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.9.6/ace.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.9.6/mode-xml.min.js"></script>
<script src="{{wf_editor_js}}"></script>

{% endblock head %}

{% block content %}
<div class="content" id="modeler-container">
    <quantum-workflow-modeler id="main-wf-modeler"></quantum-workflow-modeler>
</div>
<div id="editor_wrap" style="display: none">
    <div id="editor_dragbar"></div>
    <div id="editor"></div>
</div>
{% endblock content %}

{% block script %}
{{ super() }}

<script>
    window.ENABLE_PATTERN_PLUGIN = true;

    const state = window._qhana_microfrontend_state;
    if (state) {
        state.targetHeight = "full";
    }

    const editor = ace.edit("editor");
    editor.getSession().setMode("ace/mode/xml");
    editor.setTheme("ace/theme/textmate");

    const modeler = document.getElementById("main-wf-modeler");
    console.log({ modeler });
    
    fetch('http://localhost:5005/plugins')
        .then(response => response.json())
        .then(data => {
            modeler.qhanaPlugins = data;
            console.log("Fetched QHAna Plugins:", modeler.qhanaPlugins);
        })
        .catch(error => {
            console.error("Error fetching QHAna plugins:", error);
        });

    modeler.pluginConfigs = [
        {
            name: "dataflow",
            config: {
                configurationsEndpoint: "{{dataflowEndpoint}}"
            }
        },
        {
            name: "quantme",
            config: {
                transformationFrameworkEndpoint: "{{transformationFrameworkEndpoint}}",
                nisqAnalyzerEndpoint: "{{nisqAnalyzerEndpoint}}",
                nisqAnalyzerUiEndpoint: "{{nisqAnalyzerUiEndpoint}}",
                qprovEndpoint: "{{qprovEndpoint}}",
                scriptSplitterEndpoint: "{{scriptSplitterEndpoint}}",
                scriptSplitterThreshold: "{{scriptSplitterThreshold}}",
                qiskitRuntimeHandlerEndpoint: "{{qiskitRuntimeHandlerEndpoint}}",
                awsRuntimeHandlerEndpoint: "{{awsRuntimeHandlerEndpoint}}"
            }
        },
        {
            name: "planqk"
        },
        {
            name: "qhana",
            config: {
                qhanaPluginRegistryURL: "{{qhanaPluginRegistryURL}}"
            }
        },
        {
            name: "pattern",
            config: {
                patternAtlasEndpoint: "{{patternAtlasEndpoint}}",
                patternAtlasUIEndpoint: "{{patternAtlasUIEndpoint}}",
                qcAtlasEndpoint: "{{qcAtlasEndpoint}}"
            }
        },
        {
            name: "opentosca", 
            config: {
                opentoscaEndpoint: "{{opentoscaEndpoint}}",
                wineryEndpoint: "{{wineryEndpoint}}"
            }
        }
    ];

    console.log("Plugin Configurations: ", modeler.pluginConfigs);
    console.log("QHAna Plugins: ", modeler.qhanaPlugins);
</script>

{% endblock script %}
